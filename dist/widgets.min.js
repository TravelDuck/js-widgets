!function($){function property(){return new TravelDuck_Property($(displayElement).data("property-id"))}function weekChangeOverDay(){var changeOverDay=new DayOfWeek(settings.weekChangeOverDay),dataWeekChangeOverDay=$(displayElement).data("week-change-over-day");return dataWeekChangeOverDay&&(changeOverDay=new DayOfWeek(dataWeekChangeOverDay)),changeOverDay}function numberOfMonthsToDisplay(){var numberOfMonthsToDisplay=settings.numberOfMonthsToDisplay,dataNumberOfMonthsToDisplay=$(displayElement).data("number-of-months-to-display");return dataNumberOfMonthsToDisplay&&(numberOfMonthsToDisplay=dataNumberOfMonthsToDisplay),numberOfMonthsToDisplay}function startMonth(){return new CalendarMonth(settings.startYear,settings.startMonth)}function endMonth(){return startMonth().plusMonths(numberOfMonthsToDisplay()-1)}function monthRange(){return new CalendarMonthRange(startMonth(),endMonth())}function refreshAvailability(){var firstMonthToLoadAvailability=monthRange().getStartCalendarMonth().previous(),lastMonthToLoadAvailability=monthRange().getEndCalendarMonth().next(),months=new CalendarMonthRange(firstMonthToLoadAvailability,lastMonthToLoadAvailability);property().colouredAvailability(months,function(availability){var availableToAvailable=availability.availableToAvailable,availableToUnavailable=availability.availableToUnavailable,availableToUnknown=availability.availableToUnknown,unavailableToAvailable=availability.unavailableToAvailable,unavailableToUnavailable=availability.unavailableToUnavailable,unavailableToUnknown=availability.unavailableToUnknown,unknownToAvailable=availability.unknownToAvailable,unknownToUnavailable=availability.unknownToUnavailable,unknownToUnknown=availability.unknownToUnknown;$(".travelduck.availability .day").each(function(){$(this).removeClass("available-to-available available-to-unavailable available-to-unknown")});var i,currentDay,classIdentifier;for(i=0;i<availableToAvailable.length;i++)currentDay=availableToAvailable[i],classIdentifier=currentDay.toYearMonthDayString("-"),$("."+classIdentifier).addClass("available-to-available");for(i=0;i<availableToUnavailable.length;i++)currentDay=availableToUnavailable[i],classIdentifier=currentDay.toYearMonthDayString("-"),$("."+classIdentifier).addClass("available-to-unavailable");for(i=0;i<availableToUnknown.length;i++)currentDay=availableToUnknown[i],classIdentifier=currentDay.toYearMonthDayString("-"),$("."+classIdentifier).addClass("available-to-unknown");for(i=0;i<unavailableToAvailable.length;i++)currentDay=unavailableToAvailable[i],classIdentifier=currentDay.toYearMonthDayString("-"),$("."+classIdentifier).addClass("unavailable-to-available");for(i=0;i<unavailableToUnavailable.length;i++)currentDay=unavailableToUnavailable[i],classIdentifier=currentDay.toYearMonthDayString("-"),$("."+classIdentifier).addClass("unavailable-to-unavailable");for(i=0;i<unavailableToUnknown.length;i++)currentDay=unavailableToUnknown[i],classIdentifier=currentDay.toYearMonthDayString("-"),$("."+classIdentifier).addClass("unavailable-to-unknown");for(i=0;i<unknownToAvailable.length;i++)currentDay=unknownToAvailable[i],classIdentifier=currentDay.toYearMonthDayString("-"),$("."+classIdentifier).addClass("unknown-to-available");for(i=0;i<unknownToUnavailable.length;i++)currentDay=unknownToUnavailable[i],classIdentifier=currentDay.toYearMonthDayString("-"),$("."+classIdentifier).addClass("unknown-to-unavailable");for(i=0;i<unknownToUnknown.length;i++)currentDay=unknownToUnknown[i],classIdentifier=currentDay.toYearMonthDayString("-"),$("."+classIdentifier).addClass("unknown-to-unknown");$(mainContainer).animate({opacity:1})},function(){})}function draw(){$(mainContainer).empty();for(var months=monthRange().getArrayOfAllCalendarMonths(),i=0;i<months.length;i++)addMonth(months[i])}function addMonth(calendarMonth){var changeOverDay=weekChangeOverDay(),days=calendarMonth.days(),firstDay=days[0],table=document.createElement("table");table.style.marginBottom="15px",$(table).append('<tr><td colspan="7" class="month-name">'+calendarMonth.name()+" "+calendarMonth.getYear()+"</td></tr>");for(var html="<tr>",i=0;7>i;i++)html+='<td class="day-of-week-name">'+changeOverDay.twoLetterName()+"</td>",changeOverDay=changeOverDay.next();html+="</tr>",$(table).append(html);var skip=(firstDay.dayOfWeek().getNumber()+7-changeOverDay.getNumber())%7,rows=6;for(html="<tr>",i=0;7*rows>i;i++)if(i%7==0&&0!=i&&(html+="</tr><tr>"),i-skip>=0&&i-skip<days.length){var currentDay=days[i-skip],classIdentifier=currentDay.toYearMonthDayString("-");html+='<td class="day '+classIdentifier+'">'+currentDay.getDay()+"</td>"}else html+='<td class="day"></td>';html+="</tr>",$(table).append(html),mainContainer.appendChild(table)}var displayElement,mainContainer,settings,methods={init:function(options){var currentMonth=CalendarMonth.currentMonth();return settings=$.extend({startMonth:currentMonth.getMonth(),startYear:currentMonth.getYear(),numberOfMonthsToDisplay:12,weekChangeOverDay:6},options),displayElement=this,mainContainer=document.createElement("div"),displayElement.append(mainContainer),mainContainer.style.opacity=0,draw(),refreshAvailability(),setInterval(function(){refreshAvailability()},3e4),this}};$.fn.travelduckAvailability=function(methodOrOptions){return methods[methodOrOptions]?methods[methodOrOptions].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof methodOrOptions&&methodOrOptions?void $.error("Method "+methodOrOptions+" does not exist on jQuery.travelduckAvailability"):methods.init.apply(this,arguments)}}(jQuery);var Datepicker=function(element,options){this.element=$(element),this.format=DPGlobal.parseFormat(options.format||this.element.data("date-format")||"mm/dd/yyyy"),this.allowBeforeToday=options.allowBeforeToday||this.element.data("allow-before-today")||!0,this.placeRelatively=options.placeRelatively;var parentElement=options.attachToBody?"body":element.parentNode;this.placeRelatively&&(parentElement.style.position="relative"),this.picker=$(DPGlobal.template).appendTo(parentElement).on({mousedown:$.proxy(this.click,this),mouseover:$.proxy(this.mouseover,this)});var tableBody=this.picker.find("tbody");if(tableBody.on({mouseleave:$.proxy(this.mouseout,this)}),this.isInput=this.element.is("input"),this.component=this.element.is(".date")?this.element.find(".add-on"):!1,this.isInput?this.element.on({focus:$.proxy(this.show,this),blur:$.proxy(this.hide,this),keyup:$.proxy(this.update,this)}):this.component?this.component.on("click",$.proxy(this.show,this)):this.element.on("click",$.proxy(this.show,this)),this.minViewMode=options.minViewMode||this.element.data("date-minviewmode")||0,"string"==typeof this.minViewMode)switch(this.minViewMode){case"months":this.minViewMode=1;break;case"years":this.minViewMode=2;break;default:this.minViewMode=0}if(this.viewMode=options.viewMode||this.element.data("date-viewmode")||0,"string"==typeof this.viewMode)switch(this.viewMode){case"months":this.viewMode=1;break;case"years":this.viewMode=2;break;default:this.viewMode=0}this.startViewMode=this.viewMode,this.weekStart=options.weekStart||this.element.data("date-weekstart")||0,this.weekEnd=0===this.weekStart?6:this.weekStart-1,this.onRender=options.onRender,this.placeRight=options.placeRight,this.fillDow(),this.fillMonths(),this.update(),this.showMode(),$(window).on("resize",$.proxy(this.place,this));var that=this;$(document).on("mousedown",function(ev){0==$(ev.target).closest(".travelduckDatePicker").length&&ev.target!=element&&that.hide()})};Datepicker.prototype={constructor:Datepicker,show:function(){this.picker.show(),this.height=this.component?this.component.outerHeight():this.element.outerHeight(),this.place(),this.element.trigger({type:"show",date:this.date})},hide:function(){this.picker.hide(),$(window).off("resize",this.place),this.viewMode=this.startViewMode,this.showMode(),this.isInput||$(document).off("mousedown",this.hide),this.element.trigger({type:"hide",date:this.date})},clear:function(){this.hide(),this.element.val(""),this.update(),this.element.trigger({type:"clear"})},set:function(){var formated=DPGlobal.formatDate(this.date,this.format);this.isInput?this.element.prop("value",formated):(this.component&&this.element.find("input").prop("value",formated),this.element.data("date",formated))},setValue:function(newDate){this.date="string"==typeof newDate?DPGlobal.parseDate(newDate,this.format):new Date(newDate),this.set(),this.viewDate=new Date(this.date.getFullYear(),this.date.getMonth(),1,0,0,0,0),this.fill()},setViewDate:function(viewDate){this.viewDate=new Date(viewDate.getFullYear(),viewDate.getMonth(),1,0,0,0,0),this.fill()},place:function(){var offset=this.component?this.component.offset():this.element.offset(),inputWidth=this.component?this.component.outerWidth():this.element.outerWidth(),pickerWidth=this.picker.outerWidth(),top=this.height,left=0;this.placeRelatively||(top+=offset.top,left+=offset.left),this.placeRight&&(left+=inputWidth-pickerWidth),this.picker.css({top:top,left:left}),this.placeRight?(this.picker.removeClass("place-left"),this.picker.addClass("place-right")):(this.picker.removeClass("place-right"),this.picker.addClass("place-left"))},update:function(newDate){this.date=DPGlobal.parseDate("string"==typeof newDate?newDate:this.isInput?this.element.prop("value"):this.element.data("date"),this.format),this.viewDate=new Date(this.date.getFullYear(),this.date.getMonth(),1,0,0,0,0),this.fill(),this.render()},fillDow:function(){for(var dowCnt=this.weekStart,html="<tr>";dowCnt<this.weekStart+7;)html+='<th class="dow">'+DPGlobal.dates.daysMin[dowCnt++%7]+"</th>";html+="</tr>",this.picker.find(".datepicker-days thead").append(html)},fillMonths:function(){for(var html="",i=0;12>i;)html+='<span class="month">'+DPGlobal.dates.monthsShort[i++]+"</span>";this.picker.find(".datepicker-months td").append(html)},render:function(){var that=this,today=new Date,dd=today.getDate(),mm=today.getMonth(),yyyy=today.getFullYear();today=Date.UTC(yyyy,mm,dd,0,0,0),this.picker.find(".day").each(function(index,e){var elem=$(e),dateString=elem.data("date"),date=DPGlobal.parseDate(dateString,that.format);classes=e.className.split(" ");var hasOldClass=-1!=classes.indexOf("old"),hasNewClass=-1!=classes.indexOf("new"),hasCurrentClass=-1!=classes.indexOf("current");elem.removeClass();var classes="day "+that.onRender(date);hasOldClass&&(classes+=" old"),hasNewClass&&(classes+=" new"),hasCurrentClass&&(classes+=" current"),!this.allowBeforeToday&&date.valueOf()<today.valueOf()&&(classes+=" disabled"),elem.addClass(classes)})},fill:function(){var d=new Date(this.viewDate),year=d.getFullYear(),month=d.getMonth(),currentDate=this.date.valueOf();this.picker.find(".datepicker-days th:eq(1)").text(DPGlobal.dates.months[month]+" "+year);var prevMonth=new Date(year,month-1,28,0,0,0,0),day=DPGlobal.getDaysInMonth(prevMonth.getFullYear(),prevMonth.getMonth());prevMonth.setDate(day),prevMonth.setDate(day-(prevMonth.getDay()-this.weekStart+7)%7);var nextMonth=new Date(prevMonth);nextMonth.setDate(nextMonth.getDate()+42),nextMonth=nextMonth.valueOf();for(var clsName,prevY,prevM,dateAsString,html=[];prevMonth.valueOf()<nextMonth;)prevMonth.getDay()===this.weekStart&&html.push("<tr>"),clsName="",prevY=prevMonth.getFullYear(),prevM=prevMonth.getMonth(),month>prevM&&prevY===year||year>prevY?clsName+=" old":(prevM>month&&prevY===year||prevY>year)&&(clsName+=" new"),prevMonth.valueOf()===currentDate&&(clsName+=" current"),dateAsString=DPGlobal.formatDate(prevMonth,this.format),html.push('<td data-date="'+dateAsString+'" class="day '+clsName+'">'+prevMonth.getDate()+"</td>"),prevMonth.getDay()===this.weekEnd&&html.push("</tr>"),prevMonth.setDate(prevMonth.getDate()+1);this.picker.find(".datepicker-days tbody").empty().append(html.join(""));var currentYear=this.date.getFullYear(),months=this.picker.find(".datepicker-months").find("th:eq(1)").text(year).end().find("span").removeClass("current");currentYear===year&&months.eq(this.date.getMonth()).addClass("current"),html="",year=10*parseInt(year/10,10);var yearCont=this.picker.find(".datepicker-years").find("th:eq(1)").text(year+"-"+(year+9)).end().find("td");year-=1;for(var i=-1;11>i;i++)html+='<span class="year'+(-1===i||10===i?" old":"")+(currentYear===year?" active":"")+'">'+year+"</span>",year+=1;yearCont.html(html),this.render()},click:function(e){e.stopPropagation(),e.preventDefault();var target=$(e.target).closest("span, td, th");if(1===target.length)switch(target[0].nodeName.toLowerCase()){case"th":switch(target[0].className){case"switch":this.showMode(1);break;case"prev":case"next":this.viewDate["set"+DPGlobal.modes[this.viewMode].navFnc].call(this.viewDate,this.viewDate["get"+DPGlobal.modes[this.viewMode].navFnc].call(this.viewDate)+DPGlobal.modes[this.viewMode].navStep*("prev"===target[0].className?-1:1)),this.fill(),this.set()}break;case"span":if(target.is(".clear-btn"))return void this.clear();if(target.is(".month")){var month=target.parent().find("span").index(target);this.viewDate.setMonth(month)}else{var year=parseInt(target.text(),10)||0;this.viewDate.setFullYear(year)}0!==this.viewMode&&(this.date=new Date(this.viewDate),this.element.trigger({type:"changeDate",date:this.date,viewMode:DPGlobal.modes[this.viewMode].clsName})),this.showMode(-1),this.fill(),this.set();break;case"td":if(target.is(".day")&&!target.is(".disabled")){var day=parseInt(target.text(),10)||1,month=this.viewDate.getMonth();target.is(".old")?month-=1:target.is(".new")&&(month+=1);var year=this.viewDate.getFullYear();this.date=new Date(year,month,day,0,0,0,0),this.viewDate=new Date(year,month,Math.min(28,day),0,0,0,0),this.fill(),this.set(),this.element.trigger({type:"changeDate",date:this.date,viewMode:DPGlobal.modes[this.viewMode].clsName})}}},mouseover:function(e){e.stopPropagation(),e.preventDefault();var target=$(e.target).closest("td");if(1===target.length&&target.is(".day")&&!target.is(".disabled")){var day=parseInt(target.text(),10)||1,month=this.viewDate.getMonth();target.is(".old")?month-=1:target.is(".new")&&(month+=1);var year=this.viewDate.getFullYear(),date=new Date(year,month,day,0,0,0,0);this.element.trigger({type:"hoverDate",date:date,viewMode:DPGlobal.modes[this.viewMode].clsName})}},mouseout:function(){this.element.trigger({type:"exitDate"})},mousedown:function(e){e.stopPropagation(),e.preventDefault()},showMode:function(dir){dir&&(this.viewMode=Math.max(this.minViewMode,Math.min(2,this.viewMode+dir))),this.picker.find(">div").hide().filter(".datepicker-"+DPGlobal.modes[this.viewMode].clsName).show()}},$.fn.travelduckDatePicker=function(option,val){return this.each(function(){var $this=$(this),data=$this.data("datepicker"),options="object"==typeof option&&option;data||$this.data("datepicker",data=new Datepicker(this,$.extend({},$.fn.travelduckDatePicker.defaults,options))),"string"==typeof option&&data[option](val)})},$.fn.travelduckDatePicker.defaults={onRender:function(){return""},attachToBody:!1,placeRelatively:!0,allowBeforeToday:!0},$.fn.travelduckDatePicker.Constructor=Datepicker;var DPGlobal={modes:[{clsName:"days",navFnc:"Month",navStep:1},{clsName:"months",navFnc:"FullYear",navStep:1},{clsName:"years",navFnc:"FullYear",navStep:10}],dates:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},isLeapYear:function(year){return year%4===0&&year%100!==0||year%400===0},getDaysInMonth:function(year,month){return[31,DPGlobal.isLeapYear(year)?29:28,31,30,31,30,31,31,30,31,30,31][month]},parseFormat:function(format){var separator=format.match(/[.\/\-\s].*?/),parts=format.split(/\W+/);if(!separator||!parts||0===parts.length)throw new Error("Invalid date format.");return{separator:separator,parts:parts}},parseDate:function(date,format){var val,parts=date.split(format.separator),date=new Date;if(date.setHours(0),date.setMinutes(0),date.setSeconds(0),date.setMilliseconds(0),parts.length===format.parts.length){for(var year=date.getFullYear(),day=date.getDate(),month=date.getMonth(),i=0,cnt=format.parts.length;cnt>i;i++)switch(val=parseInt(parts[i],10)||1,format.parts[i]){case"dd":case"d":day=val,date.setDate(val);break;case"mm":case"m":month=val-1,date.setMonth(val-1);break;case"yy":year=2e3+val,date.setFullYear(2e3+val);break;case"yyyy":year=val,date.setFullYear(val)}date=new Date(year,month,day,0,0,0)}return date},formatDate:function(date,format){var val={d:date.getDate(),m:date.getMonth()+1,yy:date.getFullYear().toString().substring(2),yyyy:date.getFullYear()};val.dd=(val.d<10?"0":"")+val.d,val.mm=(val.m<10?"0":"")+val.m;for(var date=[],i=0,cnt=format.parts.length;cnt>i;i++)date.push(val[format.parts[i]]);return date.join(format.separator)},headTemplate:'<thead><tr><th class="prev">&lsaquo;</th><th colspan="5"></th><th class="next">&rsaquo;</th></tr></thead>',contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>'};DPGlobal.template='<div class="travelduckDatePicker dropdown-menu"><div class="datepicker-days"><table class="table-condensed">'+DPGlobal.headTemplate+'<tbody></tbody></table><div class="clear-btn-wrapper"><span class="clear-btn">Clear</span></div></div><div class="datepicker-months"><table class="table-condensed">'+DPGlobal.headTemplate+DPGlobal.contTemplate+'</table></div><div class="datepicker-years"><table class="table-condensed">'+DPGlobal.headTemplate+DPGlobal.contTemplate+"</table></div></div>",function($){function setupDatePickers(){var startDateInput=settings.startDateInput,endDateInput=settings.endDateInput;if(!startDateInput)return void console.error("You must specify the start date input. Specify a selector such as \"#start-date\" as the 'startDateInput' option.");if(!endDateInput)return void console.error("You must specify the end date input. Specify a selector such as \"#end-date\" as the 'endDateInput' option.");var checkin=$(startDateInput).prop("readonly",!0).travelduckDatePicker({onRender:function(date){var calendarDay=CalendarDay.fromDate(date),classes=generateClasses(calendarDay,SELECTSTART),additionalClasses=settings.startDatepickerOnRender(calendarDay);return additionalClasses&&(classes=$.merge(classes,additionalClasses)),classes.join(" ")},format:settings.format,weekStart:settings.weekStart,allowBeforeToday:!1}).on("focus",function(){checkout.travelduckDatePicker("hide")}).on("changeDate",function(e){setSelectedStartDayFromDate(e.date),triggerEventStartDateChanged(),checkin.travelduckDatePicker("update"),checkout.travelduckDatePicker("update"),checkin.travelduckDatePicker("hide"),checkout.val()||checkout.travelduckDatePicker("setViewDate",e.date),checkout.focus(),checkout.travelduckDatePicker("render")}).on("hoverDate",function(e){setSelectedStartDayFromDate(e.date),checkin.travelduckDatePicker("render")}).on("exitDate",function(){selectedStartDay=null,checkin.travelduckDatePicker("render")}).on("mousedown",function(){checkin.travelduckDatePicker("show")}).on("clear",function(){clear()}),checkout=$(endDateInput).prop("readonly",!0).travelduckDatePicker({onRender:function(date){var calendarDay=CalendarDay.fromDate(date),classes=generateClasses(calendarDay,SELECTEND),additionalClasses=settings.endDatepickerOnRender(calendarDay);return additionalClasses&&(classes=$.merge(classes,additionalClasses)),classes.join(" ")},format:settings.format,weekStart:settings.weekStart,placeRight:!0,allowBeforeToday:!1}).on("focus",function(){checkin.travelduckDatePicker("hide"),checkin.val()||(clear(),checkout.travelduckDatePicker("hide"),checkin.focus())}).on("changeDate",function(e){setSelectedEndDayFromDate(e.date),triggerEventEndDateChanged(),checkin.travelduckDatePicker("update"),checkout.travelduckDatePicker("update"),checkout.blur()}).on("hide",function(){checkout.val()||clear()}).on("hoverDate",function(e){setSelectedEndDayFromDate(e.date),checkout.travelduckDatePicker("render")}).on("exitDate",function(){selectedEndDay=null,checkout.travelduckDatePicker("render")}).on("clear",function(){clear()})}function clear(){selectedStartDay=null,selectedEndDay=null,$(settings.startDateInput).val("").travelduckDatePicker("update"),$(settings.endDateInput).val("").travelduckDatePicker("update"),triggerEventClear()}function setSelectedStartDayFromDate(startDate){selectedStartDay=CalendarDay.fromDate(startDate)}function setSelectedEndDayFromDate(endDate){selectedEndDay=CalendarDay.fromDate(endDate)}function selectedDateRange(){return selectedStartDay&&selectedEndDay?new CalendarDayRange(selectedStartDay,selectedEndDay):null}function generateClasses(calendarDay,mode){var classes=[];return selectedStartDay&&calendarDay.isEqualTo(selectedStartDay)&&classes.push("start-date"),selectedEndDay&&calendarDay.isEqualTo(selectedEndDay)&&classes.push("end-date"),selectedStartDay&&selectedEndDay&&calendarDay.isGreaterThan(selectedStartDay)&&calendarDay.isLessThan(selectedEndDay)&&classes.push("selected-date"),(mode==SELECTEND&&selectedStartDay&&calendarDay.isLessThanOrEqualTo(selectedStartDay)||mode==SELECTSTART&&selectedEndDay&&calendarDay.isGreaterThanOrEqualTo(selectedEndDay))&&classes.push("disabled"),classes}function triggerEventStartDateChanged(){settings.onChangeStartDate(selectedStartDay),triggerEventDateRangeChanged()}function triggerEventEndDateChanged(){settings.onChangeEndDate(selectedEndDay),triggerEventDateRangeChanged()}function triggerEventDateRangeChanged(){settings.onChangeDateRange(selectedDateRange())}function triggerEventClear(){settings.onClear()}var settings,selectedStartDay,selectedEndDay,SELECTSTART=1,SELECTEND=2,methods={init:function(options){return settings=$.extend({startDateInput:null,endDateInput:null,format:"dd-mm-yyyy",weekStart:6,startDatepickerOnRender:function(){},endDatepickerOnRender:function(){},onChangeStartDate:function(){},onChangeEndDate:function(){},onChangeDateRange:function(){},onClear:function(){}},options),setupDatePickers(),this},selectedDateRange:function(){return selectedDateRange()},clear:function(){clear()}};$.fn.travelduckDateRangePicker=function(methodOrOptions){return methods[methodOrOptions]?methods[methodOrOptions].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof methodOrOptions&&methodOrOptions?void $.error("Method "+methodOrOptions+" does not exist on jQuery.travelduckDateRangePicker"):methods.init.apply(this,arguments)}}(jQuery),function($){function property(){return this.propertyModel||setProperty(new TravelDuck_Property($(displayElement).data("property-id"))),console.log(this.propertyModel),this.propertyModel}function setProperty(property){this.propertyModel=property}function initialise(){$(mainContainer).append("<div class='online-booking-block'><div class='minimum-price-wrapper'><span class='minimum-price'></span><span class='price-period'></span></div><div class='datepicker-wrapper'><div class='inputs-wrapper'><div class='col50'><div><input readonly class='start-date' placeholder='Start date' /></div></div><div class='col50'><div><input readonly class='end-date' placeholder='End date' /></div></div></div></div><div class='price-wrapper'><div class='booking-display'><div class='info-display'></div><div class='loading-price'><div class='text'>Doing the maths...</div><img src='https://travelduck.co/common/img/loading.gif'/></div><div class='price-display'><div class='text'>Book now from:</div><div class='price'></div><div class='period'></div></div><div class='no-price-display' style='text-align: center'><div class='title'>Request a price</div><div class='text'></div></div></div></div><div class='button-wrapper'><div class='btn btn-secondary'>Book Now</div></div><div class='secured-by-wrapper'><div class='cards'></div><i class='fa fa-lock'></i> Secured by <a target='_blank' href='https://travelduck.co'>TravelDuck</a></div></div>"),onlineBookingBlock=$(mainContainer).find(".online-booking-block"),bookBtn=$(mainContainer).find(".button-wrapper .btn"),dateInputWrapper=$(mainContainer).find(".datepicker-wrapper .inputs-wrapper"),startDateInput=$(mainContainer).find(".start-date"),endDateInput=$(mainContainer).find(".end-date"),setBookingButtonAsLoading(),setBookingButtonFromPropertyBookingMode(),infoDisplay=$(mainContainer).find(".info-display");var p=property(),changeOverDay=p.getChangeOverDay();setInfo("<div>Change over <b>"+changeOverDay.name()+"</b></div>"),bookingPriceDisplay=$(mainContainer).find(".price-display .price"),bookingPeriodDisplay=$(mainContainer).find(".price-display .period"),bookingPriceDisplayWrapper=$(mainContainer).find(".price-display"),bookingPriceLoadingWrapper=$(mainContainer).find(".loading-price"),bookingPriceContactOwnerWrapper=$(mainContainer).find(".no-price-display"),$(bookBtn).click(function(){var calendarDayRange=new CalendarDayRange(startCalendarDay,endCalendarDay);submitBookingRequest(calendarDayRange)})}function setBookingButtonFromPropertyBookingMode(){var p=property(),bookingMode=p.getBookingMode();"live"==bookingMode?setBookingButtonAsBookNow():setBookingButtonAsRequestToBook()}function setBookingButtonAsLoading(){disableBookingButton(),bookBtn.html("Loading...")}function setBookingButtonAsBookNow(){bookBtn.html("Book now"),enableBookingButton()}function setBookingButtonAsRequestToBook(){bookBtn.html("Request to book"),enableBookingButton()}function enableBookingButton(){}function disableBookingButton(){}function colourDatepickerAsError(){dateInputWrapper.addClass("has-error")}function colorDatepickerAsClear(){dateInputWrapper.removeClass("has-error")}function setDatepickerError(){colourDatepickerAsError()}function clearDatepickerError(){colorDatepickerAsClear()}function showBookingPrice(price){var animationTime=null==arguments[1]?300:arguments[1];$(bookingPriceDisplayWrapper).slideDown(animationTime),$(bookingPriceDisplay).html(price.symbol()+price.getValue())}function hideBookingPrice(){var animationTime=null==arguments[0]?300:arguments[0];$(bookingPriceDisplayWrapper).slideUp(animationTime)}function setBookingPeriodDisplay(bookingPeriod){$(bookingPeriodDisplay).html(bookingPeriod)}function showLoadingBookingPrice(){var animationTime=null==arguments[1]?300:arguments[1];$(bookingPriceLoadingWrapper).slideDown(animationTime)}function hideLoadingBookingPrice(){var animationTime=null==arguments[0]?300:arguments[0];$(bookingPriceLoadingWrapper).slideUp(animationTime)}function showContactOwnerBookingPrice(){var animationTime=null==arguments[1]?300:arguments[1];$(bookingPriceContactOwnerWrapper).slideDown(animationTime)}function hideContactOwnerBookingPrice(){var animationTime=null==arguments[0]?300:arguments[0];$(bookingPriceContactOwnerWrapper).slideUp(animationTime)}function showInfoDisplay(){var animationTime=null==arguments[0]?300:arguments[0];$(infoDisplay).slideDown(animationTime)}function hideInfoDisplay(){var animationTime=null==arguments[0]?300:arguments[0];$(infoDisplay).slideUp(animationTime)}function setInfo(info){infoDisplay.html(info)}function setupDatePickers(){var changeOverDay=parseInt(property().getChangeOverDay().getNumber()),format="dd-mm-yyyy";$.fn.travelduckDateRangePicker({format:format,weekStart:changeOverDay,startDateInput:startDateInput,endDateInput:endDateInput,onChangeStartDate:function(startCalendarDay){setStartCalendarDay(startCalendarDay)},onChangeEndDate:function(endCalendarDay){setEndCalendarDay(endCalendarDay)},onChangeDateRange:function(dateRange){clearDatepickerError(),loadPrice(dateRange)},onClear:function(){clearCalendarDays(),loadPrice(null)},startDatepickerOnRender:function(calendarDay){var calendarDayAsString=calendarDay.toYearMonthDayString(),classes=[];return(afterStartCalendarDayLimit&&calendarDay.isGreaterThan(afterStartCalendarDayLimit)||beforeEndCalendarDayLimit&&calendarDay.isLessThan(beforeEndCalendarDayLimit))&&classes.push("disabled"),startDatepickerColouring&&calendarDayAsString in startDatepickerColouring&&$.merge(classes,startDatepickerColouring[calendarDayAsString]),classes},endDatepickerOnRender:function(calendarDay){var calendarDayAsString=calendarDay.toYearMonthDayString(),classes=[];return(afterStartCalendarDayLimit&&calendarDay.isGreaterThan(afterStartCalendarDayLimit)||beforeEndCalendarDayLimit&&calendarDay.isLessThan(beforeEndCalendarDayLimit))&&classes.push("disabled"),endDatepickerColouring&&calendarDayAsString in endDatepickerColouring&&$.merge(classes,endDatepickerColouring[calendarDayAsString]),classes}})}function setStartCalendarDay(calendarDay){startCalendarDay=calendarDay,afterStartCalendarDayLimit=calculateAfterStartDateLimit(startCalendarDay,availability.available),beforeEndCalendarDayLimit=calculateBeforeEndDateLimit(startCalendarDay,availability.available)}function setEndCalendarDay(calendarDay){endCalendarDay=calendarDay,afterStartCalendarDayLimit=calculateAfterStartDateLimit(endCalendarDay,availability.available),beforeEndCalendarDayLimit=calculateBeforeEndDateLimit(endCalendarDay,availability.available)}function clearCalendarDays(){startCalendarDay=null,endCalendarDay=null,afterStartCalendarDayLimit=null,beforeEndCalendarDayLimit=null}function calculateAfterStartDateLimit(currentCalendarDay,available){do currentCalendarDay=currentCalendarDay.plusDays(1);while(available.contains(currentCalendarDay));return currentCalendarDay}function calculateBeforeEndDateLimit(currentCalendarDay,available){do currentCalendarDay=currentCalendarDay.minusDays(1);while(available.contains(currentCalendarDay));return currentCalendarDay}function submitBookingRequest(calendarDayRange){if(setBookingButtonAsLoading(),!calendarDayRange.getStartCalendarDay()||!calendarDayRange.getEndCalendarDay())return setDatepickerError("Select booking dates"),void setBookingButtonFromPropertyBookingMode();var request=new TravelDuck_Property_Booking_Request(property(),calendarDayRange);request.submit(function(response){window.location.href=response.url},function(){setBookingButtonFromPropertyBookingMode()})}function loadPrice(calendarDayRange){if(calendarDayRange){showLoadingBookingPrice(),hideBookingPrice(),hideInfoDisplay(),hideContactOwnerBookingPrice();var numberOfAdults=1,numberOfChildren=0,numberOfInfants=0,numberOfPets=0;property().bookingQuote(calendarDayRange,numberOfAdults,numberOfChildren,numberOfInfants,numberOfPets,function(amount){if(hideLoadingBookingPrice(),null!=amount){var numberOfNights=calendarDayRange.countNights(),period=numberOfNights+(numberOfNights>1?" Nights":" Night");showBookingPrice(amount),setBookingPeriodDisplay(period)}else showContactOwnerBookingPrice()},function(){hideLoadingBookingPrice(),showContactOwnerBookingPrice()})}else hideBookingPrice(),hideContactOwnerBookingPrice(),showInfoDisplay()}function startDatepickerColouringAsArray(colouring){return datepickerColouringAsArray(colouring,!0)}function endDatepickerColouringAsArray(colouring){return datepickerColouringAsArray(colouring,!1)}function datepickerColouringAsArray(colouring,selectStartDate){for(var colouringClassesArray=[],calendarDaysToColour=calendarMonthRange.getArrayOfAllCalendarDays(),numberOfDaysToColour=calendarDaysToColour.length,i=0;numberOfDaysToColour>i;i++){var calendarDay=calendarDaysToColour[i],classes=[];colouring.availableToAvailable.contains(calendarDay)&&classes.push("available-to-available"),colouring.availableToUnavailable.contains(calendarDay)&&(classes.push("available-to-unavailable"),selectStartDate&&classes.push("disabled")),colouring.availableToUnknown.contains(calendarDay)&&(classes.push("available-to-unknown"),selectStartDate&&classes.push("disabled")),colouring.unavailableToAvailable.contains(calendarDay)&&(classes.push("unavailable-to-available"),selectStartDate||classes.push("disabled")),colouring.unavailableToUnavailable.contains(calendarDay)&&(classes.push("unavailable-to-unavailable"),classes.push("disabled")),colouring.unavailableToUnknown.contains(calendarDay)&&classes.push("unavailable-to-unknown"),colouring.unknownToAvailable.contains(calendarDay)&&(classes.push("unknown-to-available"),selectStartDate||classes.push("disabled")),colouring.unknownToUnavailable.contains(calendarDay)&&classes.push("unknown-to-unavailable"),colouring.unknownToUnknown.contains(calendarDay)&&classes.push("unknown-to-unknown"),colouringClassesArray[calendarDay.toYearMonthDayString()]=classes
}return colouringClassesArray}function loadColouredAvailability(successCallback,failureCallback){successCallback=null!=successCallback?successCallback:function(){},failureCallback=null!=failureCallback?failureCallback:function(){},property().colouredAvailability(calendarMonthRange,function(loadedColouring,loadedAvailability){startDatepickerColouring=startDatepickerColouringAsArray(loadedColouring),endDatepickerColouring=endDatepickerColouringAsArray(loadedColouring),availability=loadedAvailability,successCallback(loadedColouring,loadedAvailability,calendarMonthRange)},function(){failureCallback()})}function disableDateSection(){$(startDateInput).prop("disabled",!0),$(endDateInput).prop("disabled",!0)}function enableDateSection(){$(startDateInput).prop("disabled",!1),$(endDateInput).prop("disabled",!1)}var displayElement,mainContainer,startDateInput,endDateInput,dateInputWrapper,infoDisplay,bookBtn,onlineBookingBlock,bookingPriceDisplayWrapper,bookingPriceDisplay,bookingPeriodDisplay,bookingPriceLoadingWrapper,bookingPriceContactOwnerWrapper,settings,currentMonth=CalendarMonth.currentMonth(),calendarMonthRange=new CalendarMonthRange(currentMonth.minusMonths(1),currentMonth.plusMonths(40)),availability={available:[],unavailable:[]},startDatepickerColouring=[],endDatepickerColouring=[],startCalendarDay=null,endCalendarDay=null,afterStartCalendarDayLimit=null,beforeEndCalendarDayLimit=null,methods={init:function(options){return settings=$.extend({},options),displayElement=this,mainContainer=document.createElement("div"),displayElement.append(mainContainer),property().readFromApi(function(){initialise(),hideBookingPrice(0),hideLoadingBookingPrice(0),hideContactOwnerBookingPrice(0),disableDateSection(),loadColouredAvailability(function(){setupDatePickers(),enableDateSection()},function(){}),setInterval(function(){loadColouredAvailability(function(){},function(){})},3e4)},function(){console.error("")}),this}};$.fn.travelduckOnlineBookingBlock=function(methodOrOptions){return methods[methodOrOptions]?methods[methodOrOptions].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof methodOrOptions&&methodOrOptions?void $.error("Method "+methodOrOptions+" does not exist on jQuery.travelduckOnlineBookingBlock"):methods.init.apply(this,arguments)}}(jQuery),function($){function property(){return this.propertyModel||setProperty(new TravelDuck_Property($(displayElement).data("property-id"))),this.propertyModel}function setProperty(property){this.propertyModel=property}function initialiseModal(){var p=property(),bookingMode=p.getBookingMode();$(mainContainer).append('<div style="display:none" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h3 class="modal-title">Book with TravelDuck</h3></div><div class="modal-body"><div class="datepicker-inputs"><div class="inputs-wrapper"><div class="col50"><input readonly class="start-date" placeholder="Start date" /></div><div class="col50"><input readonly class="end-date" placeholder="End date" /></div></div><div class="btn btn-secondary reset-btn">Reset</div></div><div class="booking-display-wrapper"><div class="booking-display"><div class="loading-price"><div class="text">Doing the maths...</div><img src="https://travelduck.co/common/img/loading.gif" /></div><div class="price-display"><div class="text">Book now from:</div><div class="price"></div><div class="btn btn-secondary">Book Now</div></div><div class="contact-owner" style="text-align: center"><div class="title">Request a price</div><div class="btn btn-secondary" style="margin-top:10px">Book Now</div><div class="text"></div></div></div></div><table><tr><td style="width:80px"><a href=\'https://travelduck.co\'><img class="img-round" style="width:100%" src="https://travelduck.co/travelduck/img/logo-square/80x80-fit-circle.png" /></a></td><td><ul class="fa-ul"><li class="fa fa-check"><span>Book directly with owner</span></li><li class="fa fa-check"><span>Secured by <a target="_blank" href="https://travelduck.co">TravelDuck</a></span></li><li class="fa fa-check"><span>Credit / debit card payment</span></li><li class="fa fa-check"><span>No booking fee</span></li></ul></td></tr></table></div></div></div></div>');var modal=$(mainContainer).find(".modal");$(modal).modal({show:!1});var buttonText="live"==bookingMode?"Book now":"Request to book";$(mainContainer).append('<button class="btn btn-secondary book-online-btn">'+buttonText+"</button>");var bookOnlineButton=$(mainContainer).find(".book-online-btn");$(bookOnlineButton).click(function(){$(modal).modal("show")}),startDateInput=$(mainContainer).find(".start-date"),endDateInput=$(mainContainer).find(".end-date"),resetInputBtn=$(mainContainer).find(".reset-btn"),bookingPriceDisplayWrapper=$(mainContainer).find(".price-display"),bookingPriceDisplay=$(mainContainer).find(".price-display .price"),bookingPriceLoadingWrapper=$(mainContainer).find(".loading-price"),bookingPriceContactOwnerWrapper=$(mainContainer).find(".contact-owner");var bookingPriceDisplayBookButton=$(mainContainer).find(".price-display .btn"),bookingPriceContactOwnerButton=$(mainContainer).find(".contact-owner .btn");$(resetInputBtn).click(function(){resetDatePickers()}),$(bookingPriceDisplayBookButton).click(function(){submitBookingRequest(startCalendarDay,endCalendarDay)}),$(bookingPriceContactOwnerButton).click(function(){submitBookingRequest(startCalendarDay,endCalendarDay)})}function submitBookingRequest(startDay,endDay){var calendarDayRange=new CalendarDayRange(startDay,endDay),request=new TravelDuck_Property_Booking_Request(property(),calendarDayRange);request.submit(function(response){window.location.href=response.url})}function setupDatePickers(){var changeOverDay=parseInt(property().getChangeOverDay().getNumber()),format="dd-mm-yyyy",checkin=$(startDateInput).travelduckDatePicker({todayBtn:!0,onRender:function(date){var classes=[];return classes=addColourClasses(CalendarDay.fromDate(date),colouring,classes,!0),classes.join(" ")},format:format,weekStart:changeOverDay}).on("changeDate",function(e){setStartCalendarDay(e.date),checkout.travelduckDatePicker("setValue",e.date),checkin.travelduckDatePicker("update"),checkout.travelduckDatePicker("update"),checkin.travelduckDatePicker("hide"),checkout.focus(),loadPrice()}),checkout=$(endDateInput).travelduckDatePicker({onRender:function(date){var classes=[];return classes=addColourClasses(CalendarDay.fromDate(date),colouring,classes,!1),classes.join(" ")},format:format,weekStart:changeOverDay}).on("changeDate",function(e){setEndCalendarDay(e.date),checkin.travelduckDatePicker("update"),checkout.travelduckDatePicker("update"),checkout.travelduckDatePicker("hide"),loadPrice()})}function loadPrice(){if(startCalendarDay&&endCalendarDay){showLoadingBookingPrice(),hideBookingPrice(),hideContactOwnerBookingPrice();var calendarDayRange=new CalendarDayRange(startCalendarDay,endCalendarDay),numberOfAdults=1,numberOfChildren=0,numberOfInfants=0,numberOfPets=0;property().bookingQuote(calendarDayRange,numberOfAdults,numberOfChildren,numberOfInfants,numberOfPets,function(amount){hideLoadingBookingPrice(),null!=amount?showBookingPrice(amount):showContactOwnerBookingPrice()},function(){hideLoadingBookingPrice(),showContactOwnerBookingPrice()})}else hideBookingPrice(),hideContactOwnerBookingPrice()}function loadColouredAvailability(){property().colouredAvailability(calendarMonthRange,function(loadedColouring,loadedAvailability){colouring=loadedColouring,availability=loadedAvailability,enableDateSection(),setupDatePickers()},function(){disableDateSection()})}function disableDateSection(){$(startDateInput).prop("disabled",!0),$(endDateInput).prop("disabled",!0)}function enableDateSection(){$(startDateInput).prop("disabled",!1),$(endDateInput).prop("disabled",!1)}function resetDatePickers(){startCalendarDay=null,endCalendarDay=null,afterStartCalendarDayLimit=null,beforeEndCalendarDayLimit=null,$(startDateInput).val("").travelduckDatePicker("update"),$(endDateInput).val("").travelduckDatePicker("update"),loadPrice()}function addColourClasses(calendarDay,colouring,classes,selectStartDate){return startCalendarDay&&calendarDay.isEqualTo(startCalendarDay)&&classes.push("start-date"),endCalendarDay&&calendarDay.isEqualTo(endCalendarDay)&&classes.push("end-date"),startCalendarDay&&endCalendarDay&&calendarDay.isGreaterThan(startCalendarDay)&&calendarDay.isLessThan(endCalendarDay)&&classes.push("selected-date"),(afterStartCalendarDayLimit&&calendarDay.isGreaterThan(afterStartCalendarDayLimit)||beforeEndCalendarDayLimit&&calendarDay.isLessThan(beforeEndCalendarDayLimit)||!selectStartDate&&startCalendarDay&&calendarDay.isLessThanOrEqualTo(startCalendarDay)||selectStartDate&&endCalendarDay&&calendarDay.isGreaterThanOrEqualTo(endCalendarDay))&&classes.push("disabled"),colouring.availableToAvailable.contains(calendarDay)&&classes.push("available-to-available"),colouring.availableToUnavailable.contains(calendarDay)&&(classes.push("available-to-unavailable"),selectStartDate&&classes.push("disabled")),colouring.availableToUnknown.contains(calendarDay)&&(classes.push("available-to-unknown"),selectStartDate&&classes.push("disabled")),colouring.unavailableToAvailable.contains(calendarDay)&&(classes.push("unavailable-to-available"),selectStartDate||classes.push("disabled")),colouring.unavailableToUnavailable.contains(calendarDay)&&(classes.push("unavailable-to-unavailable"),classes.push("disabled")),colouring.unavailableToUnknown.contains(calendarDay)&&classes.push("unavailable-to-unknown"),colouring.unknownToAvailable.contains(calendarDay)&&(classes.push("unknown-to-available"),selectStartDate||classes.push("disabled")),colouring.unknownToUnavailable.contains(calendarDay)&&classes.push("unknown-to-unavailable"),colouring.unknownToUnknown.contains(calendarDay)&&classes.push("unknown-to-unknown"),classes}function setStartCalendarDay(startDate){startCalendarDay=CalendarDay.fromDate(startDate),afterStartCalendarDayLimit=calculateAfterStartDateLimit(startCalendarDay,availability.available),beforeEndCalendarDayLimit=calculateBeforeEndDateLimit(startCalendarDay,availability.available)}function setEndCalendarDay(endDate){endCalendarDay=CalendarDay.fromDate(endDate),afterStartCalendarDayLimit=calculateAfterStartDateLimit(endCalendarDay,availability.available),beforeEndCalendarDayLimit=calculateBeforeEndDateLimit(endCalendarDay,availability.available)}function calculateAfterStartDateLimit(currentCalendarDay,available){do currentCalendarDay=currentCalendarDay.plusDays(1);while(available.contains(currentCalendarDay));return currentCalendarDay}function calculateBeforeEndDateLimit(currentCalendarDay,available){do currentCalendarDay=currentCalendarDay.minusDays(1);while(available.contains(currentCalendarDay));return currentCalendarDay}function showBookingPrice(price){var animationTime=null==arguments[1]?300:arguments[1];$(bookingPriceDisplayWrapper).slideDown(animationTime),$(bookingPriceDisplay).html(price.symbol()+price.getValue())}function hideBookingPrice(){var animationTime=null==arguments[0]?300:arguments[0];$(bookingPriceDisplayWrapper).slideUp(animationTime)}function showLoadingBookingPrice(){var animationTime=null==arguments[1]?300:arguments[1];$(bookingPriceLoadingWrapper).slideDown(animationTime)}function hideLoadingBookingPrice(){var animationTime=null==arguments[0]?300:arguments[0];$(bookingPriceLoadingWrapper).slideUp(animationTime)}function showContactOwnerBookingPrice(){var animationTime=null==arguments[1]?300:arguments[1];$(bookingPriceContactOwnerWrapper).slideDown(animationTime)}function hideContactOwnerBookingPrice(){var animationTime=null==arguments[0]?300:arguments[0];$(bookingPriceContactOwnerWrapper).slideUp(animationTime)}var displayElement,mainContainer,startDateInput,endDateInput,resetInputBtn,bookingPriceDisplayWrapper,bookingPriceDisplay,bookingPriceLoadingWrapper,bookingPriceContactOwnerWrapper,settings,currentMonth=CalendarMonth.currentMonth(),calendarMonthRange=new CalendarMonthRange(currentMonth.minusMonths(1),currentMonth.plusMonths(40)),availability={available:[],unavailable:[]},colouring={availableToAvailable:[],availableToUnavailable:[],availableToUnknown:[],unavailableToAvailable:[],unavailableToUnavailable:[],unavailableToUnknown:[],unknownToAvailable:[],unknownToUnavailable:[],unknownToUnknown:[]},startCalendarDay=null,endCalendarDay=null,afterStartCalendarDayLimit=null,beforeEndCalendarDayLimit=null,methods={init:function(options){return settings=$.extend({},options),displayElement=this,mainContainer=document.createElement("div"),displayElement.append(mainContainer),property().readFromApi(function(){initialiseModal(),hideBookingPrice(0),hideLoadingBookingPrice(0),hideContactOwnerBookingPrice(0),disableDateSection(),loadColouredAvailability(),setInterval(function(){loadColouredAvailability()},3e4)},function(){console.error("")}),this}};$.fn.travelduckOnlineBookingModal=function(methodOrOptions){return methods[methodOrOptions]?methods[methodOrOptions].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof methodOrOptions&&methodOrOptions?void $.error("Method "+methodOrOptions+" does not exist on jQuery.travelduckOnlineBookingModal"):methods.init.apply(this,arguments)}}(jQuery),$(function(){$(".travelduck.availability").each(function(){$(this).travelduckAvailability()}),$(".travelduck.onlineBookingModal").each(function(){$(this).travelduckOnlineBookingModal()}),$(".travelduck.onlineBookingBlock").each(function(){$(this).travelduckOnlineBookingBlock()})});